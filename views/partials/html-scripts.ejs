<script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
<script>
  // ************* Navbar 主題選擇器 *************
  const themeDropdown = document.querySelector("details.my-theme-selector");
  const currentThemeIndicator = document.getElementById("currentTheme");
  const themeItems = document.querySelectorAll(".menu a[data-theme]");
  
  // 主題切換功能 - 簡化版本
  function changeTheme(theme) {
    // 更改 html 元素的 data-theme 屬性
    document.documentElement.setAttribute("data-theme", theme);
    
    // 儲存到 Cookies
    Cookies.set("preferredTheme", theme, {expires: 365});
    
    // 批量更新 UI
    updateThemeUI(theme);
    
    // 關閉下拉選單
    themeDropdown.removeAttribute("open");
    
    // 防止預設連結行為
    event.preventDefault();
    return false;
  }

  // 統一的 UI 更新函數
  function updateThemeUI(theme) {
    // 更新主題指示器
    currentThemeIndicator.textContent = theme;
    currentThemeIndicator.className = `badge badge-sm ml-1 badge-${
      theme === "dark" ? "neutral" : "primary"
    }`;
    
    // 更新選中狀態 - 使用緩存的元素
    themeItems.forEach(item => {
      item.classList.toggle("active", item.dataset.theme === theme);
    });
  }

  // 頁面載入時初始化主題
  function initializeTheme() {
    const savedTheme = Cookies.get("preferredTheme") || "retro";

    // 應用主題
    document.documentElement.setAttribute("data-theme", savedTheme);
    updateThemeUI(savedTheme);
  }

  // 點擊外部時自動收合下拉選單
  function setupDropdownAutoClose() {
    document.addEventListener("click", function (event) {
      // 尋找所有 details 元素（下拉選單）
      const allDetails = document.querySelectorAll("details[open]");

      allDetails.forEach((detail) => {
        // 檢查點擊是否在此下拉選單外部
        if (!detail.contains(event.target)) {
          detail.removeAttribute("open");
        }
      });
    });
  }

  // DOM 準備就緒時執行
  document.addEventListener("DOMContentLoaded", function () {
    initializeTheme();
    setupDropdownAutoClose();
  });
</script>
